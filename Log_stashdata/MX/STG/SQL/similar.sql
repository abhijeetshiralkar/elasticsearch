with similar_CTE AS(Select A.material,  Substring(T.ChildVPN,1,LEN(T.ChildVPN)-1)  as Similarsku from(SELECT distinct SP.material FROM  IMG_DATA.dbo.TBL_CROSSSELL_MX SP with(nolock)where SP.SalesOrganization = '3070'AND SP.ServiceType in ('U','D') )A Cross apply (Select ISNULL(B.ChildVPN,'') + ',' from IMG_DATA.dbo.TBL_CROSSSELL_MX B with(nolock) where B.Material=A.Material and B.SalesOrganization = '3070' AND B.ServiceType in ('U','D')  for XML path('')) T(ChildVPN)) SELECT ('MX01' + '@@' + '3070' + '@@' + '10' + '@@' + 'A300'+ '-'+ P.material) AS x_rec_spec,Similarsku FROM catalog.materials P with (nolock) INNER JOIN similar_CTE sp ON  sp.material = P.material WHERE P.SalesOrganization = '3070' AND P .WebVisibleFlag = 'WebVisibleFlag' AND  P.DeleteFlag IS NULL